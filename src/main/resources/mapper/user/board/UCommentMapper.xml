<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ksmart.ks50team01.user.board.mapper.UCommentMapper2">

    <resultMap type="UComment" id="postCommentMap">
        <id property="commentNum" column="PST_CMNT_NO"/>
        <result property="commentRegId" column="REG_MBR_ID"/>
        <result property="postNum" column="PST_NO"/>
        <result property="commentContent" column="PST_CMNT_CN"/>
        <result property="commentlikeTotal" column="PST_CMNT_LIKE_TOTAL" />
        <result property="commentDislikeTotal" column="PST_CMNT_DISLIKE_TOTAL"/>
        <result property="commentReportTotal" column="PST_CMNT_REPT_TOTAL"/>
        <result property="commentAct" column="ACT_YN"/>
        <result property="commentRegDate" column="REG_YMD"/>
        <result property="commentMdfDate" column="MDFCN_YMD"/>
        <result property="commentDelDate" column="DEL_YMD"/>
    </resultMap>

    <!-- saveComment -->
    <insert id="saveComment" parameterType="UComment">
        <selectKey keyProperty="commentNum" resultType="String" order="BEFORE">
            <!-- 댓글 번호 자동증가 -->
            SELECT
            CONCAT(
            'PST_CMNT_', 
            MAX(CAST(SUBSTRING_INDEX(PC.PST_CMNT_NO, 'PST_CMNT_', -1) AS UNSIGNED)) + 1
            ) AS commentNum
            FROM
            POST_COMMENT AS PC
        </selectKey>
        INSERT INTO 
        POST_COMMENT (PST_CMNT_NO, REG_MBR_ID, PST_NO,  PST_CMNT_CN, REG_YMD) 
        VALUES 
        (#{commentNum}, #{commentRegId}, #{postNum}, #{commentContent}, NOW());
    </insert>
    
    <!-- PST_CMNT_LIKE_TOTAL 컬럼에 기본값 추가 -->
    
    

    <!-- 다른 쿼리들... -->
    <select id="findAllByPostNum" resultType="UComment">
        SELECT
        PST_CMNT_NO,
        REG_MBR_ID,
        PST_CMNT_CN,
        REG_YMD
        FROM 
        POST_COMMENT
        WHERE 
        PST_NO = #{postNum};
    </select>

</mapper>
