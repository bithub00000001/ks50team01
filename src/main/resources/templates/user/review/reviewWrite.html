<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
                xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
                layout:decorate="~{user/layout/default}">

<head>
    <link href="/user/css/reviewWrite.css" rel="stylesheet">
</head>

<th:block layout:fragment="customContent">
    <body id="body" class="up-scroll">

        <div class="main-wrapper destination-single-city">
            <!-- ====================================
            ———	PAGE TITLE
            ===================================== -->
            <section class="page-title">
                <div class="page-title-img bg-img bg-overlay-darken" style="background-image: url(#);">
                    <div class="container">
                        <div class="row align-items-center justify-content-center" style="height: 200px;">
                            <div class="col-lg-6">
                                <div class="page-title-content">
                                    <div class="title-border">
                                        <h2 class="text-uppercase text-white font-weight-bold">후기작성</h2>
                                    </div>
                                    <p class="text-white mb-0"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

<!-- ====================================
———    CITY SECTION
===================================== -->
<section class="py-10">
    <div class="container">
        <form id="reviewForm" action="#" method="POST">
            <div class="separator1"></div> <!-- 굵은 직선 추가 -->
            <div class="star-group_box">
                <label for="rating">별점</label>
                <div class="separator2"></div> <!-- 굵은 직선 추가 -->
                <div class="star-rating">
                    <input type="radio" id="rating5" name="rating" value="5"><label for="rating5">★</label>
                    <input type="radio" id="rating4" name="rating" value="4"><label for="rating4">★</label>
                    <input type="radio" id="rating3" name="rating" value="3"><label for="rating3">★</label>
                    <input type="radio" id="rating2" name="rating" value="2"><label for="rating2">★</label>
                    <input type="radio" id="rating1" name="rating" value="1"><label for="rating1">★</label>
                </div>
                <!-- 추가된 부분 -->
                <div class="evaluation">별점을 선택해주세요</div>
            </div>
            <div class="separator1"></div> <!-- 굵은 직선 추가 -->
            <div class="form-group_box">
                <label for="review">구매후기 작성</label>
                <div class="separator2"></div> <!-- 굵은 직선 추가 -->
                <textarea id="review" name="review" rows="5" maxlength="1000"
                    placeholder="솔직한 후기를 작성해주세요.&#13;&#10;최소 10자 이상을 입력해주세요"></textarea>
            
                <div class="char-count" id="charCount">0/1000</div> <!-- 글자 수 표시 -->
            </div>

            <div class="separator1"></div> <!-- 굵은 직선 추가 -->
            <div class="img">
                <label for="photo">사진 첨부</label>
                <input type="file" id="photo" name="photo" multiple> <!-- multiple 속성을 추가하여 여러 파일 선택 가능 -->
            </div>
            <div class="separator2"></div> <!-- 굵은 직선 추가 -->
            <div id="attachedFiles"></div> <!-- 첨부 파일 목록이 표시될 영역 -->
            <div class="separator1"></div> <!-- 굵은 직선 추가 -->
            <div class="form-group">
                <!-- Thymeleaf를 사용하여 링크의 대상 URL 설정 -->
                <a th:href="@{#}"><button type="button" class="btn">취소</button></a>
                <a th:href="@{#}"><button type="button" class="btn">등록</button></a>
            </div>

            <!-- 추가된 요소: 별점 평가 문구 -->
            <div class="rating-text" id="ratingText"></div>
        </form>
    </div>

</section>
<script>
    const stars = document.querySelectorAll('.star-rating input');
        let previousRating = 0;

        stars.forEach((star, index) => {
        star.addEventListener('click', () => {
            if (index + 1 === previousRating) {
                // 클릭한 별점이 이전에 선택한 별점과 같은 경우 취소
                resetStars();
                previousRating = 0;
                document.querySelector('.evaluation').textContent = '별점을 선택해주세요'; // 평가 문구 초기화
            } else {
                resetStars();
                for (let i = 0; i <= index; i++) {
                    stars[i].checked = true;
                    stars[i].nextElementSibling.style.color = '#ffcc00';
                }
                previousRating = index + 1;
                // 별점에 따른 평가 문구 출력
                switch (previousRating) {
                    case 5:
                        document.querySelector('.evaluation').textContent = '최고에요';
                        break;
                    case 4:
                        document.querySelector('.evaluation').textContent = '만족해요';
                        break;
                    case 3:
                        document.querySelector('.evaluation').textContent = '보통이에요';
                        break;
                    case 2:
                        document.querySelector('.evaluation').textContent = '별로에요';
                        break;
                    case 1:
                        document.querySelector('.evaluation').textContent = '최악이에요';
                        break;
                    default:
                        document.querySelector('.evaluation').textContent = '별점을 선택해주세요';
                        break;
                    }
                }
            });

            star.addEventListener('mouseenter', () => {
                // 이전 별까지만 호버 효과 적용
                for (let i = 0; i <= index; i++) {
                    stars[i].nextElementSibling.style.color = '#ffcc00';
                }
            });

            star.addEventListener('mouseleave', () => {
                // 별점이 선택되지 않았을 때만 초기화
                if ((index + 1) !== previousRating) {
                    resetStars();
                    document.querySelector('.evaluation').textContent = ''; // 평가 문구 제거
                }
            });
        });

        function resetStars() {
            stars.forEach(star => {
                star.checked = false;
                star.nextElementSibling.style.color = '#f5f5f5';
            });
        }

        // 플레이스홀더 텍스트를 관리하는 함수
        function managePlaceholderText() {
            var textarea = document.getElementById('review');
            if (textarea.value.trim() === '') { // 텍스트 영역이 비어있을 경우에만 플레이스홀더 텍스트를 표시
                textarea.classList.add('placeholder-text');
            } else {
                textarea.classList.remove('placeholder-text');
            }
        }

        // 텍스트 영역의 입력 이벤트를 감지하여 플레이스홀더 텍스트 관리
        document.getElementById('review').addEventListener('input', managePlaceholderText);

        // 텍스트 입력 시 글자 수 표시
        const reviewTextarea = document.getElementById('review');
        const charCount = document.getElementById('charCount');

        reviewTextarea.addEventListener('input', function() {
            const textLength = this.value.length;
            charCount.textContent = textLength + '/1000';
        });
        
        const fileInput = document.getElementById('photo');
        const attachedFilesContainer = document.getElementById('attachedFiles');
        let uploadedFiles = []; // 기존에 업로드된 파일 목록을 저장하는 배열

        fileInput.addEventListener('change', function() {
            const files = this.files;

            // 새로 추가된 파일을 기존 파일 목록에 추가
            for (let i = 0; i < files.length; i++) {
                uploadedFiles.push(files[i]);
            }

            // 기존 파일 목록과 새로 추가된 파일을 모두 표시
            displayAttachedFiles();
        });

        // 기존 파일 목록과 새로 추가된 파일을 모두 표시하는 함수
        function displayAttachedFiles() {
            attachedFilesContainer.innerHTML = ''; // 기존 첨부 파일 목록 초기화

            // 파일을 순회하며 각 파일에 대한 정보를 표시
            for (let i = 0; i < uploadedFiles.length; i++) {
                const file = uploadedFiles[i];
                const fileItem = document.createElement('div');
                fileItem.classList.add('attached-file');

                // 썸네일 이미지 생성 (여기서는 간단하게 파일 아이콘으로 대체)
                const thumbnail = document.createElement('img');
                thumbnail.src = 'file-icon.png'; // 썸네일 이미지 경로 설정
                thumbnail.alt = 'File Icon';
                thumbnail.classList.add('thumbnail');
                fileItem.appendChild(thumbnail);

                // 파일 이름 표시
                const fileName = document.createElement('span');
                fileName.textContent = file.name;
                fileItem.appendChild(fileName);

                // 파일 삭제 버튼 생성
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'X';
                deleteButton.classList.add('delete-button');
                deleteButton.addEventListener('click', function() {
                    // 클릭한 버튼의 부모 요소인 첨부 파일 아이템을 삭제
                    uploadedFiles.splice(i, 1); // 배열에서 해당 인덱스의 파일을 제거
                    displayAttachedFiles(); // 변경된 파일 목록을 다시 표시
                });
                fileItem.appendChild(deleteButton);

                // 생성된 첨부 파일 아이템을 목록에 추가
                attachedFilesContainer.appendChild(fileItem);
            }
        }

        const photoLabel = document.querySelector('label[for="photo"]');
        photoLabel.addEventListener('click', function(event) {
            event.preventDefault(); // 기본 동작(파일 열기)을 막음
        });
</script>
        </div>
    </body>
</th:block>
</html>
