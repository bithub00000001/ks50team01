<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{user/layout/default}">
<head>
<title>리뷰 목록</title>
<th:block layout:fragment="customCss">
	<link th:href="@{/user/css/reviewList.css}" rel="stylesheet">
	<link th:href="@{/user/plugins/owl-carousel/owl.carousel.min.css}"
		rel='stylesheet' media='screen'>
	<link th:href="@{/user/plugins/owl-carousel/owl.theme.default.min.css}"
		rel='stylesheet' media='screen'>
	<!-- GOOGLE FONT -->
	<link
		href='https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700'
		rel='stylesheet'>
</th:block>
</head>
<th:block layout:fragment="customContent">
	<!-- ====================================
    ——— PAGE TITLE
    ===================================== -->
	<section class="page-title">
		<div class="page-title-img bg-img bg-overlay-darken"
			style="background-image: url(/user/img/pages/page-title-bg11.jpg);">
			<div class="container">
				<div class="row align-items-center justify-content-center"
					style="height: 200px;">
					<div class="col-lg-6">
						<div class="page-title-content">
							<div class="title-border">
								<h2 class="text-uppercase text-white font-weight-bold">리뷰목록</h2>
							</div>
							<p class="text-white mb-0"></p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- ====================================
    ——— CITY SECTION
    ===================================== -->
	<section class="py-10">
		<div class="container">
		
		
			<div class="review-container">
				<div class="review-box" id="review-box">
					<!-- 리뷰 내용이 여기에 동적으로 추가될 것입니다. -->
				</div>
				<!-- 버튼 영역을 리뷰 영역에 포함시킴 -->
				<div class="review-box" id="button-container">
					<!-- 버튼 영역이 여기에 동적으로 추가될 것입니다. -->
				</div>
			</div>
		</div>
	</section>
</th:block>

<th:block layout:fragment="customJs">
	<script>
 // 리뷰 데이터
    const reviews = [
        {
            id: 1,
            userId: "user123",
            rating: 4,
            date: "2024-04-25",
            modifiedDate: "2024-04-28",
            content: "이 상품 정말 좋아요!",
            image: ["/user/img/blog/blog-03.jpg", "/user/img/blog/blog-04.jpg"]
        },
        {
            id: 2,
            userId: "user456",
            rating: 5,
            date: "2024-04-20",
            content: "완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!",
            image: ["/user/img/blog/blog-03.jpg"]
        },
        {
            id: 3,
            userId: "user123",
            rating: 2,
            date: "2024-04-25",
            modifiedDate: "2024-04-28",
            content: "이 상품 정말 좋아요!",
            image: []
        },
        {
            id: 4,
            userId: "user456",
            rating: 1,
            date: "2024-04-20",
            content: "완전 강추합니다!",
            image:["/user/img/blog/blog-03.jpg", "/user/img/blog/blog-04.jpg", "/user/img/blog/blog-03.jpg", "/user/img/blog/blog-04.jpg"]
        },
        {
            id: 5,
            userId: "user456",
            rating: 5,
            date: "2024-04-20",
            content: "완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!완전 강추합니다!",
            image: ["/user/img/blog/blog-03.jpg", "/user/img/blog/blog-04.jpg"]
        },
    ];

    // 좋아요, 싫어요 카운트
    let likeCounts = {};
    let dislikeCounts = {};

    // 별점을 표시하는 함수
    function displayRating(rating) {
        let stars = '';
        for (let i = 0; i < 5; i++) {
            if (i < rating) {
                stars += '<span class="rating">★</span>';
            } else {
                stars += '<span class="rating">☆</span>'; // Use ☆ (empty star) for ratings less than current index
            }
        }
        return stars;
    }


    <!-- 리뷰를 화면에 출력하는 함수 수정 -->
    function displayReviews() {
        const reviewBox = document.getElementById('review-box');
        reviewBox.innerHTML = '';
        if (reviews.length === 0) {
            const noReviewHTML = '<div class="no-review">작성된 리뷰가 없습니다.</div>';
            reviewBox.innerHTML = noReviewHTML;
        } else {
            reviews.forEach(review => {
                // 좋아요, 싫어요 카운트 초기화
                likeCounts[review.id] = 0;
                dislikeCounts[review.id] = 0;

                let modifiedDateHTML = review.modifiedDate ? ` (수정됨 ${review.modifiedDate})` : '';

                let imageHTML = ''; // 이미지 HTML을 저장할 변수 초기화

                // 이미지가 배열 형태인지 확인
                if (Array.isArray(review.image)) {
                    // 이미지가 배열인 경우, 모든 이미지를 표시
                    imageHTML += `<div class="image-container" id="review-${review.id}">`; // 이미지를 감싸는 컨테이너 열기
                    review.image.forEach((image, index) => {
                        imageHTML += `<img src="${image}" alt="Review Image ${index + 1}">`;
                    });
                    imageHTML += `</div>`; // 이미지를 감싸는 컨테이너 닫기
                } else {
                    // 이미지가 배열이 아닌 경우, 단일 이미지 표시
                    imageHTML = `<img src="${review.image}" alt="Review Image">`;
                }

                let reviewHTML = `
                    <div class="review">
                        <div class="review-content">
                            <div class="user-id">${review.userId}</div>
                            <div class="date">${review.date}${modifiedDateHTML}</div>
                            <div class="rating">${displayRating(review.rating)}</div>
                            <p>${review.content}</p>
                            ${imageHTML} <!-- 이미지 HTML 삽입 -->
                        </div>
                        <div class="button-container">
                            <div class="like-dislike-report">
                                <button class="like-btn" onclick="increaseLike(${review.id})">❤️ 좋아요 (<span id="like-count-${review.id}">${likeCounts[review.id]}</span>)</button>
                                <button class="dislike-btn" onclick="increaseDislike(${review.id})">❌ 싫어요 (<span id="dislike-count-${review.id}">${dislikeCounts[review.id]}</span>)</button>
                                <a th:href="@{/review/report}"><button class="report-btn">신고하기</button></a>
                                <!-- <a th:href="@{#}"><button type="button" class="btn register-button">등록</button></a> -->
                            </div>
                        </div>
                    </div>`;
                reviewBox.innerHTML += reviewHTML;
            });

            // 이미지 슬라이더 초기화
            initImageSlider();
        }
    }
    
    function initImageSlider() {
        // 모든 리뷰에 대해 이미지 슬라이더를 초기화
        reviews.forEach(review => {
            const imageContainer = document.querySelector(`#review-${review.id} .image-container`);
            const imageCount = review.image.length;

            // 이미지가 3장 이상인 경우에만 슬라이더 초기화
            if (imageCount > 3) {
                imageContainer.classList.add('owl-carousel'); // Owl Carousel 클래스 추가

                // Owl Carousel을 초기화하고 옵션 설정
                $(imageContainer).owlCarousel({
                    loop: true,
                    margin: 10,
                    nav: false, // 네비게이션 비활성화
                    dots: false, // 도트 표시 비활성화
                    responsive: {
                        0: {
                            items: 1 // 화면 너비가 0px 이상일 때 1개의 이미지만 표시
                        },
                        600: {
                            items: 3 // 화면 너비가 600px 이상일 때 3개의 이미지를 슬라이드로 표시
                        },
                        1000: {
                            items: 5 // 화면 너비가 1000px 이상일 때 5개의 이미지를 슬라이드로 표시
                        }
                    },
                    navText: ['<button type="button" role="presentation" class="owl-prev"><i class="fa fa-chevron-left"></i></button>', '<button type="button" role="presentation" class="owl-next"><i class="fa fa-chevron-right"></i></button>'] // 네비게이션 바 설정
                });
            }
        });
    }

    // 좋아요 클릭 시
    function increaseLike(reviewId) {
        likeCounts[reviewId]++;
        document.getElementById(`like-count-${reviewId}`).textContent = likeCounts[reviewId];
    }

    // 싫어요 클릭 시
    function increaseDislike(reviewId) {
        dislikeCounts[reviewId]++;
        document.getElementById(`dislike-count-${reviewId}`).textContent = dislikeCounts[reviewId];
    }
    
 // 문서가 로드된 후에 실행되는 코드
    window.onload = function() {
        displayReviews();
    };
    
    
    </script>
</th:block>
</html>
