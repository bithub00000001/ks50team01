<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
				xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
				layout:decorate="~{user/layout/default}">

	<head>
		<title>ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€</title>
	</head>
	
	<th:block layout:fragment="customCss">
		<link th:href="@{/user/css/postDetail.css}" rel="stylesheet">
		<link th:href="@{/user/css/report.css}" rel="stylesheet">
		
    	<!-- GOOGLE FONT -->
    	<link href='https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700' rel='stylesheet'>
	</th:block>

	<th:block layout:fragment="customPageSection">
		<!-- ê²Œì‹œë¬¼ ë‚´ìš©ì„ ë³´ì—¬ì£¼ëŠ” ì»¨í…Œì´ë„ˆ -->
		<div class="container post-detail-container">
			<div class="row">
				<div class="col-lg-8 col-md-10 mx-auto">
					<div class="post" th:object="${postDetail}">
						<div class="post-header">
							<!-- align-items-startë¡œ ë³€ê²½ -->
						    <div class="d-flex align-items-start">
						    	<!-- ê²Œì‹œê¸€ ì¹´í…Œê³ ë¦¬ ë±ƒì§€ -->
						    	<i class="badge rounded-pill bg-primary badge-cate me-2" th:text="*{category.postCategoryName}"></i>
								<!-- ê²Œì‹œê¸€ ì œëª© --> 
								<h2 class="post-title mb-5" th:text="*{postTitle}">ê²Œì‹œë¬¼ ì œëª©</h2>
								<!-- ëŒ“ê¸€ ìˆ˜ê°€ 0ë³´ë‹¤ í° ê²½ìš°ì—ë§Œ ëŒ“ê¸€ ìˆ˜ ë±ƒì§€ í‘œì‹œ -->
								<span th:if="${#lists.size(commentList) > 0}"
									class="badge bg-info comment-badge"
									th:text="${#lists.size(commentList)}"></span>
							</div>
						</div>
	
						<p class="post-meta">
							<span th:text="'ì‘ì„±ì : ' + *{postRegId}">ì‘ì„±ì ì•„ì´ë””</span> <span
								th:text="'ë“±ë¡ì¼ : ' + *{#strings.substring(postRegDate, 0, 10)}">ì‘ì„±ì¼</span>
							<span th:text="'ì¡°íšŒìˆ˜ : ' + *{postInqCnt}">0</span>
						</p>
						<!-- êµµì€ ì§ì„  ì¶”ê°€ -->
						<hr class="my-4">
						<p class="post-content" th:utext="*{postContent}">ê²Œì‹œë¬¼ ë‚´ìš©</p>

<!-- 						<div class="separator1"></div> êµµì€ ì§ì„  ì¶”ê°€
						<div class="separator2"></div> êµµì€ ì§ì„  ì¶”ê°€ -->
		
				<div class="d-flex justify-content-end mt-10">
					<a th:href="@{/community/postModify(postNum=${postDetail.postNum})}" class="btn btn-light-gray btn-sm update-Btn">ìˆ˜ì •</a>
					<a href="#" th:data-post-num="${postDetail.postNum}" class="btn btn-off-white btn-sm delete-Btn" th:onclick="confirmDelete(this)">ì‚­ì œ</a>
				</div>	




					<hr class="my-4">
					</div>
					<div class="comments">
						<!-- ëŒ“ê¸€ ìˆ˜ í‘œì‹œ -->
						<h4 class="comment-count"
							th:text="${#lists.size(commentList)} + 'ê°œì˜ ëŒ“ê¸€'"></h4>
						<!-- ëŒ“ê¸€ ëª©ë¡ -->
						<div class="comment-list">
							<ul style="padding-left: 0rem;">
								<!-- ëŒ“ê¸€ ì¶œë ¥ ë° ë‹µê¸€ ë‹¬ê¸° -->
								<li th:each="l : ${commentList}" class="list-group">
									<div class="comment list-group-item">
										<div class="comment-meta">
											<div class="col-10 d-flex align-items-center">
												<!-- ì‘ì„±ì ì•„ì´ì½˜ -->
												<i class="fa fa-user-circle fa-3x text-primary" aria-hidden="true"></i> 
												<span class="comment-author" th:text="${l.commentRegId}">ëŒ“ê¸€ ì‘ì„±ì ì•„ì´ë””</span> 
												<span class="comment-date m-2" th:text="${#strings.substring(l.commentRegDate, 0, 10)}">ëŒ“ê¸€ ì‘ì„±ì¼</span>
												<!-- ì‹ ê³  ë²„íŠ¼  -->
												<button type="button" class="btn btn-lg report-btn" data-bs-toggle="modal" data-bs-target="#staticBackdrop">ğŸš¨</button>
											</div>
											
											<!-- ëŒ“ê¸€ ìˆ˜ì • ì‚­ì œ ë²„íŠ¼ -->
											<div class="col-2">
												<div class="dropdown float-end">
													<button class="btn btn-xs dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="true"></button>
													<ul class="dropdown-menu P-0" aria-labelledby="dropdownMenuButton1">
														<li>
															<a class="dropdown-item small" href="#" onclick="editComment(event)">
																<i class="fa-solid fa-eraser fa-2x edit-button"></i> ìˆ˜ì •</a></li>
														<li><a class="dropdown-item small" href="#" onclick="deleteComment()">
														<i class="fa-solid fa-trash-can fa-2x delete-button"></i> ì‚­ì œ</a></li>
													</ul>
												</div>
											</div>
											<!-- Button trigger modal -->
	
	
	
	
											<!-- ëŒ“ê¸€ ìˆ˜ì • ë° ì‚­ì œ ì•„ì´ì½˜ 
											<div class="modify-btn delete-btn">
												<i class="fa-solid fa-eraser fa-2x"></i>
												ì‚¬ê°í˜• ë‹«ê¸° ì•„ì´ì½˜
												<i class="fa-solid fa-square-xmark fa-2x"></i>
												ì›í˜• ë‹«ê¸° ì•„ì´ì½˜
												<i class="fa-solid fa-circle-xmark fa-2x"></i>
											</div> -->
	
	
											<!-- ëŒ“ê¸€ ìˆ˜ì •, ëŒ“ê¸€ ì‚­ì œ ë“œë¡­ë‹¤ìš´
											<div class="dropdown">
												<i class="fa-solid fa-ellipsis-vertical fa-2x"
													onclick="toggleDropdownMenu()"></i>
												<div id="dropdown-menu" class="dropdown-menu">
													<i class="dropdown-item1 fa-solid fa-eraser fa-2x edit-button" onclick="editComment()"></i>
													<i class="dropdown-item2 fa-solid fa-square-xmark fa-2x delete-button" onclick="deleteComment()"></i>
													<i class="dropdown-item3 fa-solid fa-trash-can fa-2x delete-button" onclick="deleteComment()"></i>
													<i class="dropdown-item4 fa-regular fa-trash-can fa-2x delete-button" onclick="deleteComment()"></i>
												</div>
											</div> -->
	
										</div>
										<!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ -->
										<p class="comment-content" id="commentList" th:text="${l.commentContent}">ëŒ“ê¸€ ë‚´ìš©</p>
	
										<div class="comment-actions">
											<!-- ë‹µê¸€ ë‹¬ê¸° ë²„íŠ¼ -->
											<button class="btn btn-primary rounded-pill btn-xs reply-btn"
												data-bs-toggle="modal" data-bs-target="#replyModal">
												<i class="fa fa-reply"></i> ë‹µê¸€
											</button>
	
											<!-- ëŒ“ê¸€ ì‹«ì–´ìš” ë²„íŠ¼ -->
											<button class="btn btn-outline-danger btn-xs dislike-btn">
												<i class="fa-regular fa-thumbs-down"></i><span
													class="dislike-count">0</span>
											</button>
	
											<!-- ëŒ“ê¸€ ì¢‹ì•„ìš” ë²„íŠ¼ -->
											<button class="btn btn-outline-primary btn-xs like-btn">
												<i class="fa-regular fa-thumbs-up"></i><span
													class="like-count">0</span>
											</button>
										</div>
									</div>
								</li>
							</ul>
						</div>
	
						<hr class="my-4">
<!-- 						<div class="separator3"></div> êµµì€ ì§ì„  ì¶”ê°€ -->
	
						<!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
						<div class="comment-form">
							<h4 class="">ëŒ“ê¸€ ì‘ì„±</h4>
							<!-- <form th:action="@{/comment/save}" method="post"> -->
								<input type="hidden" id="commentRegId" name="commentRegId" th:value="${session.loginId}">
								<textarea class="form-control mb-3" id="commentContent" name="commentContent" rows="5" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”." required="required"></textarea>
								<input type="hidden" id="postNum" name="postNum" th:value="${postDetail.postNum}">
								<button type="button" class="btn btn-secondary btn-sm cancle-Btn">ì·¨ì†Œ</button>
								<button type="button" class="btn btn-primary btn-sm submit-Btn" onclick="commentWrite()">ë“±ë¡</button>
							<!-- </form> -->
						</div>
						<div class="list-btn">
							<button type="button" class="btn btn-dark list-Btn" onclick="location.href='/community'">ëª©ë¡</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	
		<!-- Modal -->
		<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static"
			data-bs-keyboard="false" tabindex="-1"
			aria-labelledby="staticBackdropLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="staticBackdropLabel">ì‹ ê³ í•˜ê¸°</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<!-- Example single danger button -->
					<div class="btn-group">
						<button type="button" class="btn btn-primary dropdown-toggle px-3" data-bs-toggle="dropdown" aria-expanded="false">ì‹ ê³  ìœ í˜• ì„ íƒ</button>
						<ul class="dropdown-menu">
							<li><a class="dropdown-item">ìš•ì„¤/ì¸ì‹ ê³µê²©</a></li>
							<li><a class="dropdown-item">í™ë³´/ìƒì—…ì„±</a></li>
							<li><a class="dropdown-item">ìŒë€/ì„ ì •ì„±</a></li>
							<li><a class="dropdown-item">ê°™ì€ ë‚´ìš© ë„ë°°</a></li>
							<li><a class="dropdown-item">ë¶€ì ì ˆí•œ ì½˜í…ì¸ </a></li>
							<li><a class="dropdown-item">ìŠ¤íŒ¸ ë˜ëŠ” ê´‘ê³ </a></li>
							<li><a class="dropdown-item">ê°œì¸ì •ë³´ ë…¸ì¶œ</a></li>
							<li><a class="dropdown-item">ê¶Œë¦¬ì¹¨í•´ ì‹ ê³ </a></li>
							<li><a class="dropdown-item">ê¸°íƒ€</a></li>
						</ul>
					</div>
	
					<div class="modal-body">
						<div class="mb-3">
							<label for="message-text" class="col-form-label">ì‹ ê³  ë‚´ìš©:</label>
							<textarea class="form-control" id="message-text" maxlength="100"></textarea>
							<div id="char-count">0/100</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
						<button type="button" class="btn btn-primary">ì‹ ê³ </button>
					</div>
				</div>
			</div>
		</div>
	
		<!-- ë‹µê¸€ ëª¨ë‹¬ ì°½ -->
		<div class="modal fade" id="replyModal" tabindex="-1" role="dialog"
			aria-labelledby="replyModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="replyModalLabel">ë‹µê¸€ ì‘ì„±</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					
					<div class="modal-body">
						<!-- ë‹µê¸€ ì‘ì„± í¼ -->
						<form>
							<div class="form-group">
								<label for="replyContent">ë‹µê¸€ ë‚´ìš©</label>
								<textarea class="form-control" id="replyContent" rows="5" placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
							</div>
						</form>
	
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">ë‹«ê¸°</button>
						<button type="button" class="btn btn-primary" id="saveReplyButton">ì €ì¥</button>
					</div>
				</div>
			</div>
		</div>
	</th:block>


	<th:block layout:fragment="customJsFIle">
	    <script src="https://kit.fontawesome.com/8374b337d7.js" crossorigin="anonymous"></script>
	</th:block>


	<th:block layout:fragment="customJs">
		<script th:inline="javascript">
		
		//ëŒ“ê¸€ ì‘ì„±
		const commentWrite = () => {
		    const commentRegId = document.getElementById("commentRegId").value;
		    const commentContent = document.getElementById("commentContent").value;
		    const postNum = document.getElementById("postNum").value;
		    
		    console.log("ì‘ì„±ì : ", commentRegId);
		    console.log("ë‚´ìš© : ", commentContent);
		    console.log("ê²Œì‹œê¸€ ë²ˆí˜¸ : ", postNum);
		    
		    $.ajax({
		        url: "/community/commentSave", // ì„œë²„ ìš”ì²­ ì£¼ì†Œ
		        type: "POST",
		    	dataType:'json',
		        data: {
		            'postNum': postNum,
		            'commentRegId': commentRegId,
		            'commentContent': commentContent
		        },
		        success: function(res) {
		            alert('ëŒ“ê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
		            $('#commentContent').val(''); // í…ìŠ¤íŠ¸ë°•ìŠ¤ ì´ˆê¸°í™”
		            location.reload();
		            //loadComments(); // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜ í˜¸ì¶œ (í•„ìš” ì‹œ)
		        },
		        error: function(err) {
		            console.log("ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ", err);
		            alert('ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
		        }
		    });
		}

		
		
	    /* ëŒ“ê¸€ ìˆ˜ì • í¼ ì—´ê¸° */
	    function modifyCommentForm(event) {
	        event.preventDefault();
	        const commentItem = $(event.target).closest('li');
	        commentItem.find('.comment-content').hide();
	        commentItem.find('.commentModifyForm').show();
	    }

	    /* ëŒ“ê¸€ ìˆ˜ì • */
	    function modifyComment(event) {
	        const commentItem = $(event.target).closest('li');
	        const commentNum = commentItem.find('.commentNum').val();
	        const commentContent = commentItem.find('#commentContent').val();
	        $.ajax({
	            type: 'PUT',
	            url: `/community/commentModify/${commentNum}`,
	            data: JSON.stringify({ commentContent: commentContent }),
	            contentType: 'application/json',
	            success: function () {
	                alert("ëŒ“ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
	                commentItem.find('.comment-content').text(commentContent).show();
	                commentItem.find('.commentModifyForm').hide();
	            },
	            error: function () {
	                alert("ëŒ“ê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
	            }
	        });
	    }

	    /* ëŒ“ê¸€ ìˆ˜ì • ì·¨ì†Œ */
	    function cancelModifyC(event) {
	        const commentItem = $(event.target).closest('li');
	        commentItem.find('.commentModifyForm').hide();
	        commentItem.find('.comment-content').show();
	    }

	    /* ëŒ“ê¸€ ì‚­ì œ */
	    function deleteComment(event) {
	        event.preventDefault();
	        const commentItem = $(event.target).closest('li');
	        const commentNo = commentItem.find('.commentNo').val();
	        const isConfirmed = confirm("ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
	        if (isConfirmed) {
	            $.ajax({
	                type: 'DELETE',
	                url: `/community/commentDelete/${commentNo}`,
	                success: function () {
	                    alert("ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
	                    commentItem.remove();
	                },
	                error: function () {
	                    alert("ëŒ“ê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
	                }
	            });
	        }
	    }
		
		
		
	

		
	</script>
	
	
		<script>
		    document.addEventListener('DOMContentLoaded', function () {
		        let dropdownButton = document.querySelector('.modal-dialog .dropdown-toggle');
		        let dropdownMenuItems = document.querySelectorAll('.modal-dialog .dropdown-menu .dropdown-item');
	
		        dropdownMenuItems.forEach(function (item) {
		            item.addEventListener('click', function () {
		                let selectedText = item.textContent;
		                if (dropdownButton.textContent !== selectedText) {
		                    dropdownButton.textContent = selectedText;
		                }
		            });
		        });
	
		        dropdownButton.addEventListener('click', function () {
		            if (dropdownButton.textContent === "ì‹ ê³  ìœ í˜• ì„ íƒ") {
		                return;
		            } else {
		                dropdownButton.textContent = "ì‹ ê³  ìœ í˜• ì„ íƒ";
		            }
		        });
		    });
		
		
			function toggleDropdownMenu() {
				const dropdownMenu = document.getElementById('dropdown-menu');
				dropdownMenu.classList.toggle('show');
			}

			// ëŒ“ê¸€ ìˆ˜ì • ë²„íŠ¼ í´ë¦­í–ˆì„ ë•Œ
			function editComment(event) {
			    event.preventDefault();
			    const commentItem = $(event.target).closest('li');
			    commentItem.find('.comment-content').hide();
			    commentItem.find('.commentModifyForm').show();
			}

			function deleteComment() {
				// ì‚­ì œ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ ìˆ˜í–‰í•  ì‘ì—…ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
				// ì´ í•¨ìˆ˜ëŠ” ì‹¤ì œë¡œ ì‚­ì œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
			}

			// í´ë¦­ ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ê³³ì´ ì•„ë‹Œ ë‹¤ë¥¸ ê³³ì„ í´ë¦­í•˜ë©´ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ë¥¼ ë‹«ìŠµë‹ˆë‹¤.
			document.addEventListener('click', function(event) {
				const dropdownMenu = document.getElementById('dropdown-menu');
				if (!event.target.matches('.fa-solid.fa-ellipsis-vertical') && dropdownMenu != null) {
					dropdownMenu.classList.remove('show');
				}
			});

		

    
    
		    // ê²Œì‹œë¬¼, ëŒ“ê¸€ ì¢‹ì•„ìš” ì‹«ì–´ìš” ë²„íŠ¼ í´ë¦­ ì‹œ ìˆ«ì ì¦ê°€
		    document.addEventListener("DOMContentLoaded", function() {
		        const buttons = document.querySelectorAll('.like-btn, .dislike-btn');
		
		        buttons.forEach(function(button) {
		            button.addEventListener('click', function(event) {
		                const countElement = this.querySelector('.like-count') || this.querySelector('.dislike-count');
		                let count = parseInt(countElement.textContent);
		                count++;
		                countElement.textContent = count;
		            });
		        });
		    });
		    
		    
			// ëŒ€ëŒ“ê¸€ ì‘ì„±ì°½
			function reCommentForm(event) {
				var reCommentForm = event.target.closest(".commentList").nextElementSibling;
				while (reCommentForm) {
					if (reCommentForm.classList.contains("reCommentForm")) {
						break;
					}
					reCommentForm = reCommentForm.nextElementSibling;
				}
				if (reCommentForm) {
					reCommentForm.style.display = reCommentForm.style.display === "none" ? "block"
							: "none";
				}
			}

			// ëŒ€ëŒ“ê¸€ ì‘ì„± ajax 
			function insertReComment(event) {
				var commentStep = parseInt($(event.target).closest('.reCommentForm').find('#commentStep').val());
				
		/* 		alert("ê·¸ë£¹" + $('#pgroup').val())
				alert("ìŠ¤í…" + commentStep)
				alert("ëìŠ¤" + $('#reDepth').val())
				alert("ë‚´ìš©" + $(event.target).closest('.reCommentForm').find('#reComment').val())		
		 */
				var bDto = {
					pgroup : $('#pgroup').val(),
					step : commentStep,
					depth : $("#reDepth").val(),
					content : $(event.target).closest('.reCommentForm').find(	'#reComment').val()
				};

				$.ajax({
					url : "/board/addC.do",
					data : bDto,
					type : 'POST',
					success : function(result) {
						getCommentList();
						$("#reComment").val("");
					}
				})

			}


		
			</script>
			
			

			
			
			
<!-- ê²Œì‹œê¸€ ì‚­ì œ -->	    
<script th:inline="javascript">
    function confirmDelete(element) {
        var postNum = element.getAttribute('data-post-num');
        var confirmation = confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
        
        if (confirmation) {
            // í™•ì¸ì„ ëˆ„ë¥´ë©´ ì‚­ì œ ë™ì‘ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ POST ìš”ì²­
            postDelete(postNum);
        } else {
            console.log("ì‚­ì œ ì·¨ì†Œ: " + postNum);
        }
    }

    function postDelete(postNum) {
        // POST ìš”ì²­ì„ ë³´ë‚´ê¸° ìœ„í•´ formì„ ìƒì„±
        var form = document.createElement('form');
        form.setAttribute('method', 'post');
        form.setAttribute('action', '/community/postDelete');
        form.style.display = 'none'; // formì„ ë³´ì´ì§€ ì•Šë„ë¡ ì„¤ì •

        // postNumì„ formì— ì¶”ê°€
        var input = document.createElement('input');
        input.setAttribute('type', 'hidden');
        input.setAttribute('name', 'postNum');
        input.setAttribute('value', postNum);
        form.appendChild(input);

        // formì„ bodyì— ì¶”ê°€í•˜ê³  submit
        document.body.appendChild(form);
        form.submit();
    }
    
    
    
    
    
    
</script>


	

		
		
		
		

	</th:block>
	
</html>