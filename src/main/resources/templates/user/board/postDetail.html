<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
				xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
				layout:decorate="~{user/layout/default}">

	<head>
		<title>게시글 상세 페이지</title>
	</head>
	
	<th:block layout:fragment="customCss">
		<link th:href="@{/user/css/postDetail.css}" rel="stylesheet">
		<link th:href="@{/user/css/report.css}" rel="stylesheet">
		
    	<!-- GOOGLE FONT -->
    	<link href='https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700' rel='stylesheet'>
	</th:block>

	<th:block layout:fragment="customPageSection">
		<!-- 게시물 내용을 보여주는 컨테이너 -->
		<div class="container post-detail-container">
			<div class="row">
				<div class="col-lg-8 col-md-10 mx-auto">
					<div class="post" th:object="${postDetail}">
						<div class="post-header">
							<!-- align-items-start로 변경 -->
						    <div class="d-flex align-items-start">
						    	<!-- 게시글 카테고리 뱃지 -->
						    	<i class="badge rounded-pill bg-primary badge-cate me-2" th:text="*{category.postCategoryName}"></i>
								<!-- 게시글 제목 --> 
								<h2 class="post-title mb-5" th:text="*{postTitle}">게시물 제목</h2>
								<!-- 댓글 수가 0보다 큰 경우에만 댓글 수 뱃지 표시 -->
								<span th:if="${#lists.size(commentList) > 0}"
									class="badge bg-info comment-badge"
									th:text="${#lists.size(commentList)}"></span>
							</div>
						</div>
	
						<p class="post-meta">
							<span th:text="'작성자 : ' + *{postRegId}">작성자 아이디</span> <span
								th:text="'등록일 : ' + *{#strings.substring(postRegDate, 0, 10)}">작성일</span>
							<span th:text="'조회수 : ' + *{postInqCnt}">0</span>
						</p>
						<!-- 굵은 직선 추가 -->
						<hr class="my-4">
						<p class="post-content" th:utext="*{postContent}">게시물 내용</p>

<!-- 						<div class="separator1"></div> 굵은 직선 추가
						<div class="separator2"></div> 굵은 직선 추가 -->
		
				<div class="d-flex justify-content-end mt-10">
					<a th:href="@{/community/postModify(postNum=${postDetail.postNum})}" class="btn btn-light-gray btn-sm update-Btn">수정</a>
					<a href="#" th:data-post-num="${postDetail.postNum}" class="btn btn-off-white btn-sm delete-Btn" th:onclick="confirmDelete(this)">삭제</a>
				</div>	




					<hr class="my-4">
					</div>
					<div class="comments">
						<!-- 댓글 수 표시 -->
						<h4 class="comment-count"
							th:text="${#lists.size(commentList)} + '개의 댓글'"></h4>
						<!-- 댓글 목록 -->
						<div class="comment-list">
							<ul style="padding-left: 0rem;">
								<!-- 댓글 출력 및 답글 달기 -->
								<li th:each="l : ${commentList}" class="list-group">
									<div class="comment list-group-item">
										<div class="comment-meta">
											<div class="col-10 d-flex align-items-center">
												<!-- 작성자 아이콘 -->
												<i class="fa fa-user-circle fa-3x text-primary" aria-hidden="true"></i> 
												<span class="comment-author" th:text="${l.commentRegId}">댓글 작성자 아이디</span> 
												<span class="comment-date m-2" th:text="${#strings.substring(l.commentRegDate, 0, 10)}">댓글 작성일</span>
												<!-- 신고 버튼  -->
												<button type="button" class="btn btn-lg report-btn" data-bs-toggle="modal" data-bs-target="#staticBackdrop">🚨</button>
											</div>
											
											<!-- 댓글 수정 삭제 버튼 -->
											<div class="col-2">
												<div class="dropdown float-end">
													<button class="btn btn-xs dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="true"></button>
													<ul class="dropdown-menu P-0" aria-labelledby="dropdownMenuButton1">
														<li>
															<a class="dropdown-item small" href="#" onclick="editComment(event)">
																<i class="fa-solid fa-eraser fa-2x edit-button"></i> 수정</a></li>
														<li><a class="dropdown-item small" href="#" onclick="deleteComment()">
														<i class="fa-solid fa-trash-can fa-2x delete-button"></i> 삭제</a></li>
													</ul>
												</div>
											</div>
											<!-- Button trigger modal -->
	
	
	
	
											<!-- 댓글 수정 및 삭제 아이콘 
											<div class="modify-btn delete-btn">
												<i class="fa-solid fa-eraser fa-2x"></i>
												사각형 닫기 아이콘
												<i class="fa-solid fa-square-xmark fa-2x"></i>
												원형 닫기 아이콘
												<i class="fa-solid fa-circle-xmark fa-2x"></i>
											</div> -->
	
	
											<!-- 댓글 수정, 댓글 삭제 드롭다운
											<div class="dropdown">
												<i class="fa-solid fa-ellipsis-vertical fa-2x"
													onclick="toggleDropdownMenu()"></i>
												<div id="dropdown-menu" class="dropdown-menu">
													<i class="dropdown-item1 fa-solid fa-eraser fa-2x edit-button" onclick="editComment()"></i>
													<i class="dropdown-item2 fa-solid fa-square-xmark fa-2x delete-button" onclick="deleteComment()"></i>
													<i class="dropdown-item3 fa-solid fa-trash-can fa-2x delete-button" onclick="deleteComment()"></i>
													<i class="dropdown-item4 fa-regular fa-trash-can fa-2x delete-button" onclick="deleteComment()"></i>
												</div>
											</div> -->
	
										</div>
										<!-- 댓글 리스트 출력 -->
										<p class="comment-content" id="commentList" th:text="${l.commentContent}">댓글 내용</p>
	
										<div class="comment-actions">
											<!-- 답글 달기 버튼 -->
											<button class="btn btn-primary rounded-pill btn-xs reply-btn"
												data-bs-toggle="modal" data-bs-target="#replyModal">
												<i class="fa fa-reply"></i> 답글
											</button>
	
											<!-- 댓글 싫어요 버튼 -->
											<button class="btn btn-outline-danger btn-xs dislike-btn">
												<i class="fa-regular fa-thumbs-down"></i><span
													class="dislike-count">0</span>
											</button>
	
											<!-- 댓글 좋아요 버튼 -->
											<button class="btn btn-outline-primary btn-xs like-btn">
												<i class="fa-regular fa-thumbs-up"></i><span
													class="like-count">0</span>
											</button>
										</div>
									</div>
								</li>
							</ul>
						</div>
	
						<hr class="my-4">
<!-- 						<div class="separator3"></div> 굵은 직선 추가 -->
	
						<!-- 댓글 작성 폼 -->
						<div class="comment-form">
							<h4 class="">댓글 작성</h4>
							<!-- <form th:action="@{/comment/save}" method="post"> -->
								<input type="hidden" id="commentRegId" name="commentRegId" th:value="${session.loginId}">
								<textarea class="form-control mb-3" id="commentContent" name="commentContent" rows="5" placeholder="댓글을 입력하세요." required="required"></textarea>
								<input type="hidden" id="postNum" name="postNum" th:value="${postDetail.postNum}">
								<button type="button" class="btn btn-secondary btn-sm cancle-Btn">취소</button>
								<button type="button" class="btn btn-primary btn-sm submit-Btn" onclick="commentWrite()">등록</button>
							<!-- </form> -->
						</div>
						<div class="list-btn">
							<button type="button" class="btn btn-dark list-Btn" onclick="location.href='/community'">목록</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	
		<!-- Modal -->
		<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static"
			data-bs-keyboard="false" tabindex="-1"
			aria-labelledby="staticBackdropLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="staticBackdropLabel">신고하기</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<!-- Example single danger button -->
					<div class="btn-group">
						<button type="button" class="btn btn-primary dropdown-toggle px-3" data-bs-toggle="dropdown" aria-expanded="false">신고 유형 선택</button>
						<ul class="dropdown-menu">
							<li><a class="dropdown-item">욕설/인신공격</a></li>
							<li><a class="dropdown-item">홍보/상업성</a></li>
							<li><a class="dropdown-item">음란/선정성</a></li>
							<li><a class="dropdown-item">같은 내용 도배</a></li>
							<li><a class="dropdown-item">부적절한 콘텐츠</a></li>
							<li><a class="dropdown-item">스팸 또는 광고</a></li>
							<li><a class="dropdown-item">개인정보 노출</a></li>
							<li><a class="dropdown-item">권리침해 신고</a></li>
							<li><a class="dropdown-item">기타</a></li>
						</ul>
					</div>
	
					<div class="modal-body">
						<div class="mb-3">
							<label for="message-text" class="col-form-label">신고 내용:</label>
							<textarea class="form-control" id="message-text" maxlength="100"></textarea>
							<div id="char-count">0/100</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
						<button type="button" class="btn btn-primary">신고</button>
					</div>
				</div>
			</div>
		</div>
	
		<!-- 답글 모달 창 -->
		<div class="modal fade" id="replyModal" tabindex="-1" role="dialog"
			aria-labelledby="replyModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="replyModalLabel">답글 작성</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					
					<div class="modal-body">
						<!-- 답글 작성 폼 -->
						<form>
							<div class="form-group">
								<label for="replyContent">답글 내용</label>
								<textarea class="form-control" id="replyContent" rows="5" placeholder="답글을 입력하세요"></textarea>
							</div>
						</form>
	
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">닫기</button>
						<button type="button" class="btn btn-primary" id="saveReplyButton">저장</button>
					</div>
				</div>
			</div>
		</div>
	</th:block>


	<th:block layout:fragment="customJsFIle">
	    <script src="https://kit.fontawesome.com/8374b337d7.js" crossorigin="anonymous"></script>
	</th:block>


	<th:block layout:fragment="customJs">
		<script th:inline="javascript">
		
		//댓글 작성
		const commentWrite = () => {
		    const commentRegId = document.getElementById("commentRegId").value;
		    const commentContent = document.getElementById("commentContent").value;
		    const postNum = document.getElementById("postNum").value;
		    
		    console.log("작성자 : ", commentRegId);
		    console.log("내용 : ", commentContent);
		    console.log("게시글 번호 : ", postNum);
		    
		    $.ajax({
		        url: "/community/commentSave", // 서버 요청 주소
		        type: "POST",
		    	dataType:'json',
		        data: {
		            'postNum': postNum,
		            'commentRegId': commentRegId,
		            'commentContent': commentContent
		        },
		        success: function(res) {
		            alert('댓글이 작성되었습니다.');
		            $('#commentContent').val(''); // 텍스트박스 초기화
		            location.reload();
		            //loadComments(); // 댓글 목록 새로고침 함수 호출 (필요 시)
		        },
		        error: function(err) {
		            console.log("댓글 작성 중 오류 발생", err);
		            alert('댓글 작성 중 오류가 발생했습니다.');
		        }
		    });
		}

		
		
	    /* 댓글 수정 폼 열기 */
	    function modifyCommentForm(event) {
	        event.preventDefault();
	        const commentItem = $(event.target).closest('li');
	        commentItem.find('.comment-content').hide();
	        commentItem.find('.commentModifyForm').show();
	    }

	    /* 댓글 수정 */
	    function modifyComment(event) {
	        const commentItem = $(event.target).closest('li');
	        const commentNum = commentItem.find('.commentNum').val();
	        const commentContent = commentItem.find('#commentContent').val();
	        $.ajax({
	            type: 'PUT',
	            url: `/community/commentModify/${commentNum}`,
	            data: JSON.stringify({ commentContent: commentContent }),
	            contentType: 'application/json',
	            success: function () {
	                alert("댓글이 수정되었습니다.");
	                commentItem.find('.comment-content').text(commentContent).show();
	                commentItem.find('.commentModifyForm').hide();
	            },
	            error: function () {
	                alert("댓글 수정에 실패했습니다.");
	            }
	        });
	    }

	    /* 댓글 수정 취소 */
	    function cancelModifyC(event) {
	        const commentItem = $(event.target).closest('li');
	        commentItem.find('.commentModifyForm').hide();
	        commentItem.find('.comment-content').show();
	    }

	    /* 댓글 삭제 */
	    function deleteComment(event) {
	        event.preventDefault();
	        const commentItem = $(event.target).closest('li');
	        const commentNo = commentItem.find('.commentNo').val();
	        const isConfirmed = confirm("댓글을 삭제하시겠습니까?");
	        if (isConfirmed) {
	            $.ajax({
	                type: 'DELETE',
	                url: `/community/commentDelete/${commentNo}`,
	                success: function () {
	                    alert("댓글이 삭제되었습니다.");
	                    commentItem.remove();
	                },
	                error: function () {
	                    alert("댓글 삭제에 실패했습니다.");
	                }
	            });
	        }
	    }
		
		
		
	

		
	</script>
	
	
		<script>
		    document.addEventListener('DOMContentLoaded', function () {
		        let dropdownButton = document.querySelector('.modal-dialog .dropdown-toggle');
		        let dropdownMenuItems = document.querySelectorAll('.modal-dialog .dropdown-menu .dropdown-item');
	
		        dropdownMenuItems.forEach(function (item) {
		            item.addEventListener('click', function () {
		                let selectedText = item.textContent;
		                if (dropdownButton.textContent !== selectedText) {
		                    dropdownButton.textContent = selectedText;
		                }
		            });
		        });
	
		        dropdownButton.addEventListener('click', function () {
		            if (dropdownButton.textContent === "신고 유형 선택") {
		                return;
		            } else {
		                dropdownButton.textContent = "신고 유형 선택";
		            }
		        });
		    });
		
		
			function toggleDropdownMenu() {
				const dropdownMenu = document.getElementById('dropdown-menu');
				dropdownMenu.classList.toggle('show');
			}

			// 댓글 수정 버튼 클릭했을 때
			function editComment(event) {
			    event.preventDefault();
			    const commentItem = $(event.target).closest('li');
			    commentItem.find('.comment-content').hide();
			    commentItem.find('.commentModifyForm').show();
			}

			function deleteComment() {
				// 삭제 버튼을 클릭했을 때 수행할 작업을 구현합니다.
				// 이 함수는 실제로 삭제 기능을 수행해야 합니다.
			}

			// 클릭 이벤트가 발생한 곳이 아닌 다른 곳을 클릭하면 드롭다운 메뉴를 닫습니다.
			document.addEventListener('click', function(event) {
				const dropdownMenu = document.getElementById('dropdown-menu');
				if (!event.target.matches('.fa-solid.fa-ellipsis-vertical') && dropdownMenu != null) {
					dropdownMenu.classList.remove('show');
				}
			});

		

    
    
		    // 게시물, 댓글 좋아요 싫어요 버튼 클릭 시 숫자 증가
		    document.addEventListener("DOMContentLoaded", function() {
		        const buttons = document.querySelectorAll('.like-btn, .dislike-btn');
		
		        buttons.forEach(function(button) {
		            button.addEventListener('click', function(event) {
		                const countElement = this.querySelector('.like-count') || this.querySelector('.dislike-count');
		                let count = parseInt(countElement.textContent);
		                count++;
		                countElement.textContent = count;
		            });
		        });
		    });
		    
		    
			// 대댓글 작성창
			function reCommentForm(event) {
				var reCommentForm = event.target.closest(".commentList").nextElementSibling;
				while (reCommentForm) {
					if (reCommentForm.classList.contains("reCommentForm")) {
						break;
					}
					reCommentForm = reCommentForm.nextElementSibling;
				}
				if (reCommentForm) {
					reCommentForm.style.display = reCommentForm.style.display === "none" ? "block"
							: "none";
				}
			}

			// 대댓글 작성 ajax 
			function insertReComment(event) {
				var commentStep = parseInt($(event.target).closest('.reCommentForm').find('#commentStep').val());
				
		/* 		alert("그룹" + $('#pgroup').val())
				alert("스텝" + commentStep)
				alert("뎁스" + $('#reDepth').val())
				alert("내용" + $(event.target).closest('.reCommentForm').find('#reComment').val())		
		 */
				var bDto = {
					pgroup : $('#pgroup').val(),
					step : commentStep,
					depth : $("#reDepth").val(),
					content : $(event.target).closest('.reCommentForm').find(	'#reComment').val()
				};

				$.ajax({
					url : "/board/addC.do",
					data : bDto,
					type : 'POST',
					success : function(result) {
						getCommentList();
						$("#reComment").val("");
					}
				})

			}


		
			</script>
			
			

			
			
			
<!-- 게시글 삭제 -->	    
<script th:inline="javascript">
    function confirmDelete(element) {
        var postNum = element.getAttribute('data-post-num');
        var confirmation = confirm("정말 삭제하시겠습니까?");
        
        if (confirmation) {
            // 확인을 누르면 삭제 동작을 수행하기 위해 POST 요청
            postDelete(postNum);
        } else {
            console.log("삭제 취소: " + postNum);
        }
    }

    function postDelete(postNum) {
        // POST 요청을 보내기 위해 form을 생성
        var form = document.createElement('form');
        form.setAttribute('method', 'post');
        form.setAttribute('action', '/community/postDelete');
        form.style.display = 'none'; // form을 보이지 않도록 설정

        // postNum을 form에 추가
        var input = document.createElement('input');
        input.setAttribute('type', 'hidden');
        input.setAttribute('name', 'postNum');
        input.setAttribute('value', postNum);
        form.appendChild(input);

        // form을 body에 추가하고 submit
        document.body.appendChild(form);
        form.submit();
    }
    
    
    
    
    
    
</script>


	

		
		
		
		

	</th:block>
	
</html>