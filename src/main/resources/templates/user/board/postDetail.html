<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{user/layout/default}">

	<head>
		<title>ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€</title>
	</head>
	
	<th:block layout:fragment="customCss">
		<link th:href="@{/user/css/postDetail.css}" rel="stylesheet">
		<link th:href="@{/user/css/report.css}" rel="stylesheet">
		
    	<!-- GOOGLE FONT -->
    	<link href='https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700' rel='stylesheet'>
	</th:block>

	<th:block layout:fragment="customPageSection">
		<!-- ê²Œì‹œë¬¼ ë‚´ìš©ì„ ë³´ì—¬ì£¼ëŠ” ì»¨í…Œì´ë„ˆ -->
		<div class="container post-detail-container">
			<div class="row">
				<div class="col-lg-8 col-md-10 mx-auto">
					<div class="post" th:object="${postDetail}">
						<div class="post-header">
							<!-- align-items-startë¡œ ë³€ê²½ -->
						    <div class="d-flex align-items-start">
						    	<!-- ê²Œì‹œê¸€ ì¹´í…Œê³ ë¦¬ ë±ƒì§€ -->
						    	<i class="badge rounded-pill bg-primary badge-cate me-2" th:text="*{category.postCategoryName}"></i>
								<!-- ê²Œì‹œê¸€ ì œëª© --> 
								<h2 class="post-title mb-5" th:text="*{postTitle}">ê²Œì‹œë¬¼ ì œëª©</h2>
								<!-- ëŒ“ê¸€ ìˆ˜ê°€ 0ë³´ë‹¤ í° ê²½ìš°ì—ë§Œ ëŒ“ê¸€ ìˆ˜ ë±ƒì§€ í‘œì‹œ -->
								<span th:if="${#lists.size(commentList) > 0}"
									class="badge bg-info comment-badge"
									th:text="${#lists.size(commentList)}"></span>
							</div>
						</div>
	
						<p class="post-meta">
							<span th:text="'ì‘ì„±ì : ' + *{postRegId}">ì‘ì„±ì ì•„ì´ë””</span> <span
								th:text="'ë“±ë¡ì¼ : ' + *{#strings.substring(postRegDate, 0, 10)}">ì‘ì„±ì¼</span>
							<span th:text="'ì¡°íšŒìˆ˜ : ' + *{postInqCnt}">0</span>
						</p>
						<!-- êµµì€ ì§ì„  ì¶”ê°€ -->
						<hr class="my-4">
						<p class="post-content" th:text="*{postContent}">ê²Œì‹œë¬¼ ë‚´ìš©</p>
						<div class="row mt-3">
							<div class="col-md-6 offset-md-3 text-center">
								<div class="btn-group">
									<!-- ê²Œì‹œë¬¼ ì¢‹ì•„ìš” -->
									<button type="button"
										class="btn btn-primary btn-lg rounded-pill like-btn"
										style="margin-right: 50px;">
										<i class="fa-regular fa-thumbs-up fa-2x"><span
											class="like-count">0</span> </i>
									</button>
									<!-- ê²Œì‹œë¬¼ ì‹«ì–´ìš” -->
									<button type="button"
										class="btn btn-primary btn-lg rounded-pill dislike-btn">
										<i class="fa-regular fa-thumbs-down fa-2x"><span
											class="dislike-count">0</span> </i>
									</button>
								</div>
							</div>
						</div>
						<div class="separator1"></div> <!-- êµµì€ ì§ì„  ì¶”ê°€ -->
						<div class="separator2"></div> <!-- êµµì€ ì§ì„  ì¶”ê°€ -->
						<!-- <hr class="my-4"> -->
						<!-- êµµì€ ì§ì„  ì¶”ê°€ -->
					</div>
					<div class="comments">
						<!-- ëŒ“ê¸€ ìˆ˜ í‘œì‹œ -->
						<h4 class="comment-count"
							th:text="${#lists.size(commentList)} + 'ê°œì˜ ëŒ“ê¸€'"></h4>
						<!-- ëŒ“ê¸€ ëª©ë¡ -->
						<div class="comment-list">
							<ul style="padding-left: 0rem;">
								<!-- ëŒ“ê¸€ ì¶œë ¥ ë° ë‹µê¸€ ë‹¬ê¸° -->
								<li th:each="l : ${commentList}" class="list-group">
									<div class="comment list-group-item">
										<div class="comment-meta">
											<div class="col-10 d-flex align-items-center">
												<!-- ì‘ì„±ì ì•„ì´ì½˜ -->
												<i class="fa fa-user-circle fa-3x text-primary"
													aria-hidden="true"></i> <span class="comment-author"
													th:text="${l.commentRegId}">ëŒ“ê¸€ ì‘ì„±ì ì•„ì´ë””</span> <span
													class="comment-date m-2"
													th:text="${#strings.substring(l.commentRegDate, 0, 10)}">ëŒ“ê¸€
													ì‘ì„±ì¼</span>
												<!-- ì‹ ê³  ë²„íŠ¼  -->
												<button type="button" class="btn  btn-lg report-btn"
													data-bs-toggle="modal" data-bs-target="#staticBackdrop">ğŸš¨
												</button>
											</div>
											<!-- ì¶”ì²œ ë¹„ì¶”ì²œ ë²„íŠ¼, ì‚­ì œ ë²„íŠ¼ 
												<i class="fa-regular fa-thumbs-down fa-2x"></i> 
												<i class="fa-regular fa-thumbs-up fa-2x"></i> 
												<i class="fa-solid fa-trash-can fa-2x"></i>
												<i class="fa-regular fa-trash-can"></i> -->
	
	
											<!-- ì‹ ê³  ë²„íŠ¼ ëª¨ë‹¬ -->
											<div class="col-2">
	
												<div class="dropdown float-end">
													<button class="btn btn-xs dropdown-toggle" type="button"
														id="dropdownMenuButton1" data-bs-toggle="dropdown"
														aria-expanded="true"></button>
													<ul class="dropdown-menu P-0"
														aria-labelledby="dropdownMenuButton1">
														<li><a class="dropdown-item small" href="#"
															onclick="editComment()"><i
																class="fa-solid fa-eraser fa-2x edit-button"></i> ìˆ˜ì •</a></li>
														<li><a class="dropdown-item small" href="#"
															onclick="deleteComment()"><i
																class="fa-solid fa-trash-can fa-2x delete-button"></i> ì‚­ì œ</a></li>
													</ul>
												</div>
											</div>
											<!-- Button trigger modal -->
	
	
	
	
											<!-- ëŒ“ê¸€ ìˆ˜ì • ë° ì‚­ì œ ì•„ì´ì½˜ 
											<div class="modify-btn delete-btn">
												<i class="fa-solid fa-eraser fa-2x"></i>
												ì‚¬ê°í˜• ë‹«ê¸° ì•„ì´ì½˜
												<i class="fa-solid fa-square-xmark fa-2x"></i>
												ì›í˜• ë‹«ê¸° ì•„ì´ì½˜
												<i class="fa-solid fa-circle-xmark fa-2x"></i>
											</div> -->
	
	
											<!-- ëŒ“ê¸€ ìˆ˜ì •, ëŒ“ê¸€ ì‚­ì œ ë“œë¡­ë‹¤ìš´
											<div class="dropdown">
												<i class="fa-solid fa-ellipsis-vertical fa-2x"
													onclick="toggleDropdownMenu()"></i>
												<div id="dropdown-menu" class="dropdown-menu">
													<i class="dropdown-item1 fa-solid fa-eraser fa-2x edit-button" onclick="editComment()"></i>
													<i class="dropdown-item2 fa-solid fa-square-xmark fa-2x delete-button" onclick="deleteComment()"></i>
													<i class="dropdown-item3 fa-solid fa-trash-can fa-2x delete-button" onclick="deleteComment()"></i>
													<i class="dropdown-item4 fa-regular fa-trash-can fa-2x delete-button" onclick="deleteComment()"></i>
												</div>
											</div> -->
	
										</div>
	
										<p class="comment-content" th:text="${l.commentContent}">ëŒ“ê¸€
											ë‚´ìš©</p>
	
										<div class="comment-actions">
											<!-- ë‹µê¸€ ë‹¬ê¸° ë²„íŠ¼ -->
											<button class="btn btn-primary rounded-pill btn-xs reply-btn"
												data-bs-toggle="modal" data-bs-target="#replyModal">
												<i class="fa fa-reply"></i> ë‹µê¸€
											</button>
	
											<!-- ëŒ“ê¸€ ì‹«ì–´ìš” ë²„íŠ¼ -->
											<button class="btn btn-outline-danger btn-xs dislike-btn">
												<i class="fa-regular fa-thumbs-down"></i><span
													class="dislike-count">0</span>
											</button>
	
											<!-- ëŒ“ê¸€ ì¢‹ì•„ìš” ë²„íŠ¼ -->
											<button class="btn btn-outline-primary btn-xs like-btn">
												<i class="fa-regular fa-thumbs-up"></i><span
													class="like-count">0</span>
											</button>
	
	
										</div>
									</div>
								</li>
							</ul>
						</div>
<!-- 	
						êµµì€ ì§ì„  ì¶”ê°€
						<hr class="my-4"> -->
						<div class="separator3"></div> <!-- êµµì€ ì§ì„  ì¶”ê°€ -->
	
						<!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
						<div class="comment-form">
							<h4 class="">ëŒ“ê¸€ ì‘ì„±</h4>
							<form th:action="@{/comment}" method="post">
								<textarea class="form-control mb-3" name="comment" rows="5"
									placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
								<input type="hidden" name="postId"
									th:value="${postDetail.postNum}">
								<button type="submit" class="btn btn-primary">ë“±ë¡</button>
							</form>
						</div>
						<div class="list-btn">
							<button type="button" class="btn btn-dark list-btn">ëª©ë¡</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	
	
	
		<!-- Modal -->
		<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static"
			data-bs-keyboard="false" tabindex="-1"
			aria-labelledby="staticBackdropLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="staticBackdropLabel">ì‹ ê³ í•˜ê¸°</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<!-- Example single danger button -->
					<div class="btn-group">
						<button type="button" class="btn btn-primary dropdown-toggle px-3"
							data-bs-toggle="dropdown" aria-expanded="false">ì‹ ê³  ìœ í˜• ì„ íƒ</button>
	
						<ul class="dropdown-menu">
							<li><a class="dropdown-item">ìš•ì„¤/ì¸ì‹ ê³µê²©</a></li>
							<li><a class="dropdown-item">í™ë³´/ìƒì—…ì„±</a></li>
							<li><a class="dropdown-item">ìŒë€/ì„ ì •ì„±</a></li>
							<li><a class="dropdown-item">ê°™ì€ ë‚´ìš© ë„ë°°</a></li>
							<li><a class="dropdown-item">ë¶€ì ì ˆí•œ ì½˜í…ì¸ </a></li>
							<li><a class="dropdown-item">ìŠ¤íŒ¸ ë˜ëŠ” ê´‘ê³ </a></li>
							<li><a class="dropdown-item">ê°œì¸ì •ë³´ ë…¸ì¶œ</a></li>
							<li><a class="dropdown-item">ê¶Œë¦¬ì¹¨í•´ ì‹ ê³ </a></li>
							<li><a class="dropdown-item">ê¸°íƒ€</a></li>
						</ul>
					</div>
	
					<div class="modal-body">
						<div class="mb-3">
							<label for="message-text" class="col-form-label">ì‹ ê³  ë‚´ìš©:</label>
							<textarea class="form-control" id="message-text" maxlength="100"></textarea>
							<div id="char-count">0/100</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">ì·¨ì†Œ</button>
						<button type="button" class="btn btn-primary">ì‹ ê³ </button>
					</div>
				</div>
			</div>
		</div>
	
		<!-- ë‹µê¸€ ëª¨ë‹¬ ì°½ -->
		<div class="modal fade" id="replyModal" tabindex="-1" role="dialog"
			aria-labelledby="replyModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="replyModalLabel">ë‹µê¸€ ì‘ì„±</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<!-- ë‹µê¸€ ì‘ì„± í¼ -->
	
						<form>
							<div class="form-group">
								<label for="replyContent">ë‹µê¸€ ë‚´ìš©</label>
								<textarea class="form-control" id="replyContent" rows="5"
									placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
							</div>
						</form>
	
	
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">ë‹«ê¸°</button>
						<button type="button" class="btn btn-primary" id="saveReplyButton">ì €ì¥</button>
					</div>
				</div>
			</div>
		</div>
	</th:block>


	<th:block layout:fragment="customJsFIle">
	    <script th:src="@{/user/js/viewCount.js}"></script>
	    <script src="https://kit.fontawesome.com/8374b337d7.js" crossorigin="anonymous"></script>
	</th:block>


	<th:block layout:fragment="customJs">
		<script>
		    document.addEventListener('DOMContentLoaded', function () {
		        let dropdownButton = document.querySelector('.modal-dialog .dropdown-toggle');
		        let dropdownMenuItems = document.querySelectorAll('.modal-dialog .dropdown-menu .dropdown-item');
	
		        dropdownMenuItems.forEach(function (item) {
		            item.addEventListener('click', function () {
		                let selectedText = item.textContent;
		                if (dropdownButton.textContent !== selectedText) {
		                    dropdownButton.textContent = selectedText;
		                }
		            });
		        });
	
		        dropdownButton.addEventListener('click', function () {
		            if (dropdownButton.textContent === "ì‹ ê³  ìœ í˜• ì„ íƒ") {
		                return;
		            } else {
		                dropdownButton.textContent = "ì‹ ê³  ìœ í˜• ì„ íƒ";
		            }
		        });
		    });
		
			// ë’¤ë¡œ ê°€ê¸° í•¨ìˆ˜
			function goBack() {
				window.history.back();
			}
		
			function toggleDropdownMenu() {
				const dropdownMenu = document.getElementById('dropdown-menu');
				dropdownMenu.classList.toggle('show');
			}

			function editComment() {
				// ìˆ˜ì • ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ ìˆ˜í–‰í•  ì‘ì—…ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
				// ì´ í•¨ìˆ˜ëŠ” ì‹¤ì œë¡œ ìˆ˜ì • ê¸°ëŠ¥ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
			}

			function deleteComment() {
				// ì‚­ì œ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ ìˆ˜í–‰í•  ì‘ì—…ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
				// ì´ í•¨ìˆ˜ëŠ” ì‹¤ì œë¡œ ì‚­ì œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
			}

			// í´ë¦­ ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ê³³ì´ ì•„ë‹Œ ë‹¤ë¥¸ ê³³ì„ í´ë¦­í•˜ë©´ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ë¥¼ ë‹«ìŠµë‹ˆë‹¤.
			document.addEventListener('click', function(event) {
				const dropdownMenu = document.getElementById('dropdown-menu');
				if (!event.target.matches('.fa-solid.fa-ellipsis-vertical')) {
					dropdownMenu.classList.remove('show');
				}
			});
		
			document.addEventListener("DOMContentLoaded", function() {
				const listButton = document.querySelector('.list-btn'); // ëª©ë¡ ë²„íŠ¼ ê°€ì ¸ì˜¤ê¸°

				// ëª©ë¡ ë²„íŠ¼ í´ë¦­ ì‹œ
				listButton.addEventListener('click', function() {
					// ê²Œì‹œë¬¼ ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™
					window.location.href = "/community";
				});
			});
		
		    // edit comment ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
		    document.addEventListener('click', function(event) {
		        if (event.target.classList.contains('edit-button')) {
		            const comment = event.target.closest('.comment');
		            const commentContent = comment.querySelector('.comment-content').textContent;
		            const editForm = comment.querySelector('.comment-edit-form');
		            const editTextArea = editForm.querySelector('textarea');
		            
		            // ìˆ˜ì •í•  ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥ í•„ë“œì— ì±„ì›€
		            editTextArea.value = commentContent;
		
		            // í¸ì§‘ í¼ì„ ë³´ì—¬ì¤Œ
		            editForm.style.display = 'block';
		        }
		    });

		    // ìˆ˜ì •ëœ ëŒ“ê¸€ì„ ì„œë²„ì— ë³´ë‚´ê³  ì—…ë°ì´íŠ¸
		    document.addEventListener('click', function(event) {
		        if (event.target.classList.contains('btn-primary') && event.target.parentNode.classList.contains('comment-edit-form')) {
		            const editedContent = event.target.parentNode.querySelector('textarea').value;
		            const comment = event.target.closest('.comment');
		            const commentId = comment.dataset.commentId; // ëŒ“ê¸€ IDë¥¼ ê°€ì ¸ì˜´
		
		            // ìˆ˜ì •ëœ ë‚´ìš©ì„ ì„œë²„ì— ë³´ëƒ„ (AJAX ìš”ì²­)
		            fetch('/edit-comment', {
		                method: 'POST',
		                headers: {
		                    'Content-Type': 'application/json'
		                },
		                body: JSON.stringify({ commentId: commentId, editedContent: editedContent })
		            })
		            .then(response => {
		                if (!response.ok) {
		                    throw new Error('Network response was not ok');
		                }
		                // ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ë©´ í™”ë©´ì„ ìƒˆë¡œ ê³ ì³ì„œ ìˆ˜ì •ëœ ë‚´ìš©ì„ ë°˜ì˜
		                location.reload();
		            })
		            .catch(error => {
		                console.error('Error:', error);
		                alert('ëŒ“ê¸€ì„ ìˆ˜ì •í•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
		            });
		        }
		    });

		    document.addEventListener("DOMContentLoaded", function() {
		        const saveReplyButton = document.getElementById('saveReplyButton'); // ì €ì¥ ë²„íŠ¼ ê°€ì ¸ì˜¤ê¸°
		        const replyContentInput = document.getElementById('replyContent'); // ë‹µê¸€ ë‚´ìš© ì…ë ¥ í•„ë“œ ê°€ì ¸ì˜¤ê¸°
		
		        // ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ
		        saveReplyButton.addEventListener('click', function() {
		            // ì…ë ¥ëœ ë‹µê¸€ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
		            const replyContent = replyContentInput.value.trim();
		
		            // ë‹µê¸€ ë‚´ìš©ì´ ë¹„ì–´ ìˆëŠ”ì§€ í™•ì¸
		            if (replyContent === '') {
		                alert('ë‹µê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
		                return; // ë‹µê¸€ ë‚´ìš©ì´ ë¹„ì–´ìˆìœ¼ë©´ í•¨ìˆ˜ ì¢…ë£Œ
		            }
		
		            // AJAXë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì— ë‹µê¸€ ì €ì¥ ìš”ì²­ ë³´ë‚´ê¸°
		            // ì˜ˆì‹œë¡œ fetch APIë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
		            fetch('/replySave', {
		                method: 'POST', // POST ë°©ì‹ìœ¼ë¡œ ìš”ì²­
		                headers: {
		                    'Content-Type': 'application/json' // ìš”ì²­ì˜ Content-Type ì„¤ì •
		                },
		                body: JSON.stringify({ // ìš”ì²­ ë³¸ë¬¸ì— ë‹µê¸€ ë‚´ìš©ì„ JSON í˜•ì‹ìœ¼ë¡œ í¬í•¨
		                    content: replyContent
		                })
		            })
		            .then(response => {
		                if (!response.ok) { // ì‘ë‹µì´ ì„±ê³µì ì´ì§€ ì•Šì€ ê²½ìš°
		                    throw new Error('Network response was not ok');
		                }
		                // ì„±ê³µì ìœ¼ë¡œ ìš”ì²­ì´ ì™„ë£Œëœ ê²½ìš°
		                alert('ë‹µê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
		                // ì—¬ê¸°ì— ì €ì¥ í›„ ì¶”ê°€ì ìœ¼ë¡œ ìˆ˜í–‰í•  ì‘ì—…ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
		            })
		            .catch(error => {
		                console.error('Error:', error); // ì—ëŸ¬ ë°œìƒ ì‹œ ì½˜ì†”ì— ì—ëŸ¬ ì¶œë ¥
		                alert('ë‹µê¸€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
		            });
		        });
		    });
    
    
		    // ê²Œì‹œë¬¼, ëŒ“ê¸€ ì¢‹ì•„ìš” ì‹«ì–´ìš” ë²„íŠ¼ í´ë¦­ ì‹œ ìˆ«ì ì¦ê°€
		    document.addEventListener("DOMContentLoaded", function() {
		        const buttons = document.querySelectorAll('.like-btn, .dislike-btn');
		
		        buttons.forEach(function(button) {
		            button.addEventListener('click', function(event) {
		                const countElement = this.querySelector('.like-count') || this.querySelector('.dislike-count');
		                let count = parseInt(countElement.textContent);
		                count++;
		                countElement.textContent = count;
		            });
		        });
		    });
		</script>

	</th:block>
	
</html>