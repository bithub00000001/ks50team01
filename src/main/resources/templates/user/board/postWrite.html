<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
                xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
                layout:decorate="~{user/layout/default}">
                
<head>
    <title>게시글 작성</title>
    <th:block layout:fragment="customCss">
        <link th:href="@{/user/css/postWrite.css}" rel="stylesheet">
    </th:block>

</head>

<th:block layout:fragment="customPageSection">
    <!-- Elements Forms -->
    <section class="py-10">
        <div class="row">
            <div class="col-12">
                <h3 class="element-title">게시글 작성</h3>
                <div class="mb-6">
                    <form id="postForm" action="/community/postSave" method="POST" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="exampleInputText">카테고리</label>
                            <div class="select-default">
                                <select class="select-option" name="postCategory">
                                    <option value="여행 정보">여행 정보</option>
                                    <option value="여행 후기">여행 후기</option>
                                    <option value="여행 친구 찾기">여행 친구 찾기</option>
                                    <option value="자유게시판">자유게시판</option>
                                    <option value="질문게시판">질문게시판</option>
                                </select>
                            </div>
                        </div>
                        
                        

                        <div class="form-group">
                            <label for="inputTitle" class="col-sm-2 col-form-label">제목</label>
                            <input type="text" class="form-control" id="postTitle"
                                name="postTitle" placeholder="제목">
                        </div>

                        <div class="form-group">
                            <label for="exampleFormControlTextarea1">내용</label>
                            <textarea class="form-control" id="postContent"
                                name="postContent" rows="15" placeholder="내용을 입력하세요."></textarea>
                        </div>

                        <div class="pt-5 mb-5" id="modal">
                            <div class="row">
                                <div class="col-md-6 col-lg-4">
                                    <h3 class="element-title mb-5">첨부 파일</h3>
                                    <button id="attachBtn" class="btn btn-primary file-upload-btn" type="button">+ 파일 첨부하기 (0/10)</button>
                                    <input type="file" id="fileInput" style="display: none;"
                                        accept=".jpg, .jpeg, .gif, .png, .pdf" multiple>
                                    <div id="fileNames"></div>
                                </div>
                            </div>
                        </div>
                        
                        

                        <div class="d-flex justify-content-end" style="margin-bottom: 50px">
                            <!-- 등록 버튼 -->
                            <button type="submit" id="submitBtn" class="btn btn-primary mr-2">등록</button>
                            <!-- 취소 버튼 -->
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                            
                            
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
</th:block>

<th:block layout:fragment="customJsFIle">
<script>
    document.getElementById('attachBtn').addEventListener('click', function() {
        document.getElementById('fileInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', function() {
        const files = this.files;
        const fileNamesContainer = document.getElementById('fileNames');
        const uploadedFiles = fileNamesContainer.getElementsByClassName('thumbnail-container').length;
        const remainingSlots = 10 - uploadedFiles;
        
        if (files.length > remainingSlots) {
            alert('최대 10개의 파일만 업로드할 수 있습니다.');
            return;
        }

        if (files.length > 0) {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileName = file.name;

                const thumbnailContainer = document.createElement('div');
                thumbnailContainer.classList.add('thumbnail-container');

                const thumbnail = document.createElement('img');
                thumbnail.src = URL.createObjectURL(file);
                thumbnail.alt = file.name;
                thumbnail.classList.add('thumbnail');
                thumbnailContainer.appendChild(thumbnail);

                const fileNameText = document.createElement('div');
                fileNameText.textContent = fileName;
                thumbnailContainer.appendChild(fileNameText);

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'x';
                deleteButton.classList.add('delete-button');
                deleteButton.addEventListener('click', function() {
                    thumbnailContainer.remove();
                });
                thumbnailContainer.appendChild(deleteButton);

                fileNamesContainer.appendChild(thumbnailContainer);
            }
        }
    });

    document.getElementById('submitBtn').addEventListener('click', function() {
        document.getElementById('postForm').submit();
    });
</script>
    
</th:block>

</html>