<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{platform/layout/default}">
<th:block layout:fragment="customCss">
	<!-- Datatables CSS START -->
	<link th:href="@{/platform/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css}" rel="stylesheet">
	<link th:href="@{/platform/vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css}" rel="stylesheet">
	<link th:href="@{/platform/vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css}"
		rel="stylesheet">
	<link th:href="@{/platform/vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css}" rel="stylesheet">
	<link th:href="@{/platform/vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css}" rel="stylesheet">
	<!-- Datatables CSS END -->
</th:block>

<th:block layout:fragment="customContent">

	<div class="x_content">
		<div class="clearfix"></div>
	</div>
	<div class="row">
		<div class="col-xs-12 table">
			<h1 th:text="${title}"></h1>
			<form th:action="@{/platform/destination/addLodgingGoods}" method="post">
				<input hidden="hidden" type="text" name="lodgingInfoCode" id="lodgingInfoCode" value="">

				<table id="datatable-responsive" class="table table-striped table-bordered dt-responsive nowrap"
					cellspacing="0" width="100%">
					<tbody>
						<tr>
							<td><label for="lodgingName">숙소 이름</label></td>
							<td><input type="text" id="lodgingName" name="lodgingName" placeholder="숙소를 입력해주세요" readonly="readonly" />
								<button id="searchLodgingNameBtn" class="btn btn-xs" type="button"
									data-bs-toggle="modal" data-bs-target="#searchLodgingNameModal">숙소 검색
								</button>
							</td>
						</tr>
						<tr>
							<td><label for="lodgingMenuType">숙소 상품 종류</label></td>
							<td colspan="2"><input type="text" id="lodgingMenuType" name="lodgingMenuType"
									placeholder="상품 종류를 입력해주세요" disabled="disabled"></td>
						</tr>

						<tr>
							<td><label for="lodgingMenuCode">숙소 상품 메뉴코드</label></td>
							<td colspan="2"><input type="text" id="lodgingMenuCode" name="lodgingMenuCode"
									placeholder="ex: lmm_" disabled="disabled" /></td>
						</tr>
						<tr>
							<td><label for="lodgingAuthorityId">숙소 등록 권한자 아이디</label></td>
							<td colspan="2"><input type="text" id="lodgingAuthorityId" name="lodgingAuthorityId"
									placeholder="admin001" disabled="disabled" /></td>
						</tr>
						<tr>
							<td><label for="lodgingMenuMinPct">숙소 기본 인원수</label></td>
							<td colspan="2"><input type="text" id="lodgingMenuMinPct" name="lodgingMenuMinPct"
									placeholder="기본 인원수를 입력해주세요" disabled="disabled" /></td>
						</tr>
						<tr>
							<td><label for="lodgingMenuMaxPct">숙소 최대 인원수</label></td>
							<td colspan="2"><input type="text" id="lodgingMenuMaxPct" name="lodgingMenuMaxPct"
									placeholder="최대 가능 인원수를 입력해주세요" disabled="disabled" /></td>
						</tr>
						<tr>
							<td><label for="lodgingMenuPrc">숙소 요금</label></td>
							<td colspan="2"><input type="text" id="lodgingMenuPrc" name="lodgingMenuPrc"
									placeholder="숙소 요금을 입력해주세요" disabled="disabled" /></td>
						</tr>
						<tr>
							<td><label for="lodgingMenuAddprc">숙소 추가요금</label></td>
							<td colspan="2"><input type="text" id="lodgingMenuAddprc" name="lodgingMenuAddprc"
									placeholder="숙소 추가요금을 입력해주세요" disabled="disabled" /></td>
						</tr>
						<tr>
							<td><label for="lodgingMenuSmokeYn">숙소 가능 여부</label></td>
							<td colspan="2"><input type="text" id="lodgingMenuSmokeYn" name="lodgingMenuSmokeYn"
									placeholder="숙소 흡연 가능 여부를 입력해주세요" disabled="disabled" /></td>
						</tr>
						<tr>
							<td><label for="lodgingMenuBkYn">숙소 조식 유무</label></td>
							<td colspan="2"><input type="text" id="lodgingMenuBkYn" name="lodgingMenuBkYn"
									placeholder="조식 유무를 입력해주세요" disabled="disabled" /></td>
						</tr>
						<tr>
							<td><label for="lodgingRegDate">숙소상품 등록일자</label></td>
							<td colspan="2"><input type="text" id="lodgingRegDate" name="lodgingRegDate"
									placeholder="등록일자를 입력해주세요" disabled="disabled" /></td>
						</tr>

					<tfoot>
						<tr>
							<td colspan="3">
								<button type="button" class="btn btn-primary" id="addMemberBtn"
									disabled="disabled">등록</button>
								<button type="reset" class="btn btn-success" id="resetBtn"
									disabled="disabled">초기화</button>
								<button type="button" class="btn btn-secondary" id="btn-cancel">취소</button>
							</td>
						</tr>
					</tfoot>
				</table>
			</form>
		</div>
	</div>

	<!-- 숙소 검색 MODAL -->
	<div class="modal fade" id="searchLodgingNameModal" tabindex="-1" aria-labelledby="searchLodgingNameModalLabel"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="searchLodgingNameModalLabel">관광지 검색</h5>
				</div>
				<div class="modal-body">

					<input type="text" class="form-control" id="searchLodgingNameInput" placeholder="숙소를 입력해주세요.">
					<div id="searchResultContainer" class="mt-3"></div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary btn-xs" id="addLodgingNameBtn">추가</button>
					<button type="button" class="btn btn-primary btn-xs" id="searchQueries">검색</button>
					</button>
				</div>
			</div>
		</div>
	</div>
</th:block>

</html>



<th:block layout:fragment="customJsFile">
	<!-- Datatables JS START -->
	<!-- Datatables JS END -->

	<th:block layout:fragment="customJs">
		<script>
			$('#nameCheck').click(function () {
				const lodgingName = $('#lodgingName').val();
				//const $memberId = $('#memberId')[0];
				//console.log({$memberId});
				//console.log(typeof memberId);
				if (lodgingName == '') {
					alert('숙소 이름을 입력해주세요');
					$('#lodgingName').focus();
					return;
				}
				const request = $.ajax({
					method: 'GET',
					url: '/platform/destination/addLodgingCheckList',
					data: {'lodgingName': lodgingName},
					dataType: 'json'
				});
				request.done(function (res) {
					console.log(res);
					console.log(typeof res);
					const isLodgingName = res;
					$('form input').not('#lodgingName').prop('disabled', isLodgingName);
					$('form select').prop('disabled', isLodgingName);
					$('form button').not('#nameCheck').prop('disabled', isLodgingName);
					if (isLodgingName) {
						alert('등록 할 수 없는 이름입니다.');
						$('form input').val('');
						$('form select').val('');
						$('#lodgingName').focus();
					}
				});
				request.fail(function (jqXHR, textStatus, error) {
					console.log(error);
				});
			});
			$('#lodgingName').change(function () {
				$('form input').not('#lodgingName').prop('disabled', true);
				$('form select').prop('disabled', true);
				$('form button').not('#nameCheck').prop('disabled', true);
			});

			$('#addMemberBtn').click(function () {
				const lodgingName = $('lodgingName').val();
				const lodgingMenuType = $('lodgingMenuType').val();
				const lodgingInfoCode = $('lodgingInfoCode').val();
				const lodgingMenuCode = $('lodgingMenuCode').val();
				const lodgingAuthorityId = $('lodgingAuthorityId').val();
				const lodgingMenuMinPct = $('lodgingMenuMinPct').val();
				const lodgingMenuMaxPct = $('lodgingMenuMaxPct').val();
				const lodgingMenuPrc = $('lodgingMenuPrc').val();
				const lodgingMenuAddprc = $('lodgingMenuAddprc').val();
				const lodgingMenuSmokeYn = $('lodgingMenuSmokeYn').val();
				const lodgingMenuBkYn = $('lodgingMenuBkYn').val();

				let isSubmit = true;
				$('form input, form select').each(function (idx, element) {
					const id = element.id;
					const value = $(element).val();
					if (value == '') {
						const cate = $(`label[for="${id}"]`).text();
						alert(`${cate} 필수 입력항목입니다.`);
						$(element).focus();
						isSubmit = false;
						return false;
					}
				});
				if (isSubmit) $('form').submit();
			});

			// 회원 검색 모달 열기 이벤트 설정
			const searchLodgingBtn = $('#searchLodgingNameBtn');

			searchLodgingBtn.on('click', function () {
				$('#searchLodgingNameModal').modal('show');
			});
	
			// 디바운스
			const debounce = (callback, delay = 500) => {
				let timer;
				return event => {
					if (timer) clearTimeout(timer);
					timer = setTimeout(callback, delay, event);
				}
			}


			let searchResults = [];
			$('#searchLodgingNameInput').on('input', debounce(e => {
				console.log(e.target.value);
				const target = e.target;
				const value = $(target).val();
				if (!value) console.log('검색어를 입력해주세요.')
				const request = $.ajax({
					url: "/platform/destination/search-lodging-name",
					method: "GET",
					data: {
						lodgingName: value
					},
					dataType: "json"
				});
				request.done(function(data){
	                console.log(data);
	                searchResults.push(...data);
	            });
	            request.fail(function(jqXHR, status, error){
	                console.log(error);
	            });
	        }));

			const searchQueriesBtn = $('#searchQueries');
	        searchQueriesBtn.click(() => {
		        // 검색 결과 리스트 표시
		        const searchResultContainer = $('#searchResultContainer');
		        searchResultContainer.empty();
	            searchResults.forEach((lodgingInfo) => {
	                const li = $('<li></li>', {
	                    class: 'list-group-item d-flex justify-content-between align-items-center mb-5',
	                    id: 'searchList',
	                    text: lodgingInfo.lodgingName
	                });
	                
	                /* const insertBtn = $('<button></button>', {
	                    class: 'btn btn-primary btn-xs addTourNameBtn',
	                    id: 'addTourNameBtn',
	                    text: '추가'
	                }); */
	                $('#lodgingInfoCode').val(lodgingInfo.lodgingInfoCode);
	                searchResultContainer.append(li);
	                /* searchResultContainer.append(insertBtn); */
	                
	                searchResults = [];
	           	 });
	        });
			$('#addLodgingNameBtn').click(function () {
				let lodgingNameText = $(this).parent().parent().find('li').text();
				$('#lodgingName').val(lodgingNameText);
				$('form input').not('#lodgingName').prop('disabled', false);
				$('form select').prop('disabled', true);
				$('form button').not('#nameCheck').prop('disabled', false);

				$('#searchLodgingNameModal').modal('hide');
			});



		</script>
		<script th:inline="javascript">
			$('#btn-cancel').click(function () {
				window.history.back();
			})
		</script>

	</th:block>

	</html>